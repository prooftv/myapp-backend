{"version":3,"sources":["../../../src/components/SeoToolsPaneView.tsx"],"sourcesContent":["import React, { useCallback, useContext, useState } from 'react'\nimport useSWR from 'swr'\nimport YoastSEO from 'yoastseo'\nimport SerpPreview from 'react-serp-preview'\nimport { SeoToolsContext } from '../context'\nimport { InvalidConfigurationError } from '../errors'\nimport { extractErrorMessage, getYoastInsightsForContent, prepareRemoteData } from '../utils'\nimport { Box, Card, Grid, Spinner, Stack, Tab, TabList, TabPanel, Text } from '@sanity/ui'\nimport type { SanityDocument } from '@sanity/types'\nimport { SeoToolsAnalyzingCard } from './SeoToolsAnalyzingCard'\nimport { SeoToolsErrorCard } from './SeoToolsErrorCard'\nimport { AssessmentCategory } from '../constants'\nimport { SeoResultEntry } from './SeoResultEntry'\n\ntype Props = {\n  document: SanityDocument\n}\n\nexport const SeoToolsPaneView: React.FC<Props> = ({ document }) => {\n  const config = useContext(SeoToolsContext)\n  const [currentTab, setCurrentTab] = useState(AssessmentCategory.SEO)\n\n  const seoData = useSWR(['seoData', document._id, document._rev, config], async ([key, id, rev, config]) => {\n    const [seoFields, productionUrl] = await Promise.all([\n      config.select(document),\n      config.resolveProductionUrl(document),\n    ]);\n\n    if (!config.fetch && !config.prepare) {\n      throw new InvalidConfigurationError(\n        'When disabling the \"fetch\" behavior, you need to provide the prepare configuration'\n      )\n    }\n\n    const preparedData = config.fetch\n      ? await prepareRemoteData(productionUrl, {\n        contentSelector: config.contentSelector,\n      })\n      : await config.prepare!(document)\n\n    const yoastInsights = getYoastInsightsForContent(YoastSEO, preparedData.content, {\n      url: productionUrl.toString(),\n      permalink: productionUrl.toString(),\n      title: preparedData.title,\n      description: preparedData.description,\n      langCulture: preparedData.locale,\n      keyword: seoFields.focus_keyword ?? '',\n      synonyms: seoFields.focus_synonyms ?? [],\n    })\n\n    return {\n      yoastInsights,\n      productionUrl,\n      seo: seoFields,\n      prepared: preparedData,\n    }\n  }, {\n    revalidateOnFocus: false,\n  });\n\n  const handleSetSeoTab = useCallback(() => {\n    setCurrentTab(AssessmentCategory.SEO)\n  }, []);\n\n  const handleSetReadabilityTab = useCallback(() => {\n    setCurrentTab(AssessmentCategory.READABILITY)\n  }, []);\n\n  return (\n    <Box padding={3}>\n      {seoData.isValidating && (\n        <SeoToolsAnalyzingCard />\n      )}\n\n      {seoData.error && (\n        <SeoToolsErrorCard>\n          {extractErrorMessage(seoData.error)}\n        </SeoToolsErrorCard>\n      )}\n\n      {seoData.data && (\n        <Stack space={3}>\n            {config.render(seoData.data.seo, seoData.data.prepared, (\n              <Card shadow={1} padding={[2, 2, 3]}>\n                <SerpPreview\n                  title={seoData.data.seo.seo_title ?? ''}\n                  metaDescription={seoData.data.seo.meta_description ?? ''}\n                  url={seoData.data.productionUrl.toString()}\n                />\n            </Card>\n          ))}\n          <TabList space={2}>\n            <Tab\n              id=\"tablist-tab-seo\"\n              label=\"SEO\"\n              aria-controls=\"tabpanel-seo\"\n              selected={currentTab === AssessmentCategory.SEO}\n              onClick={handleSetSeoTab}\n            />\n            <Tab\n              id=\"tablist-tab-readability\"\n              label=\"Readability\"\n              aria-controls=\"tabpanel-readability\"\n              selected={currentTab === AssessmentCategory.READABILITY}\n              onClick={handleSetReadabilityTab}\n            />\n          </TabList>\n\n          <TabPanel id=\"tabpanel-seo\" aria-labelledby=\"tablist-tab-seo\" hidden={currentTab !== AssessmentCategory.SEO}>\n            <Card tone=\"default\" shadow={1} padding={[2, 2, 3]}>\n              <Stack space={3}>\n                {seoData.data.yoastInsights.seo.map((result) => (\n                  <SeoResultEntry key={result.text} result={result} />\n                ))}\n              </Stack>\n            </Card>\n          </TabPanel>\n\n          <TabPanel id=\"tabpanel-readability\" aria-labelledby=\"tablist-tab-readability\" hidden={currentTab !== AssessmentCategory.READABILITY}>\n            <Card tone=\"default\" shadow={1} padding={[2, 2, 3]}>\n              <Stack space={3}>\n                {seoData.data.yoastInsights.readability.map((result) => (\n                  <SeoResultEntry key={result.text} result={result} />\n                ))}\n              </Stack>\n            </Card>\n          </TabPanel>\n        </Stack>\n      )}\n    </Box>\n  )\n}"],"names":["React","useCallback","useContext","useState","useSWR","YoastSEO","SerpPreview","SeoToolsContext","InvalidConfigurationError","extractErrorMessage","getYoastInsightsForContent","prepareRemoteData","Box","Card","Stack","Tab","TabList","TabPanel","SeoToolsAnalyzingCard","SeoToolsErrorCard","AssessmentCategory","SeoResultEntry","SeoToolsPaneView","document","config","SEO","currentTab","setCurrentTab","seoData","_id","_rev","key","id","rev","seoFields","productionUrl","preparedData","yoastInsights","Promise","all","select","resolveProductionUrl","fetch","prepare","contentSelector","content","url","toString","permalink","title","description","langCulture","locale","keyword","focus_keyword","synonyms","focus_synonyms","seo","prepared","revalidateOnFocus","handleSetSeoTab","handleSetReadabilityTab","READABILITY","padding","isValidating","error","data","space","render","shadow","seo_title","metaDescription","meta_description","label","aria-controls","selected","onClick","aria-labelledby","hidden","tone","map","result","text","readability"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,SAASC,WAAW,EAAEC,UAAU,EAAEC,QAAQ,QAAQ,QAAO;AAChE,OAAOC,YAAY,MAAK;AACxB,OAAOC,cAAc,WAAU;AAC/B,OAAOC,iBAAiB,qBAAoB;AAC5C,SAASC,eAAe,QAAQ,aAAY;AAC5C,SAASC,yBAAyB,QAAQ,YAAW;AACrD,SAASC,mBAAmB,EAAEC,0BAA0B,EAAEC,iBAAiB,QAAQ,WAAU;AAC7F,SAASC,GAAG,EAAEC,IAAI,EAAiBC,KAAK,EAAEC,GAAG,EAAEC,OAAO,EAAEC,QAAQ,QAAc,aAAY;AAE1F,SAASC,qBAAqB,QAAQ,0BAAyB;AAC/D,SAASC,iBAAiB,QAAQ,sBAAqB;AACvD,SAASC,kBAAkB,QAAQ,eAAc;AACjD,SAASC,cAAc,QAAQ,mBAAkB;AAMjD,OAAO,IAAMC,mBAAoC,gBAAkB;QAAfC,iBAAAA;IAClD,IAAMC,SAAStB,WAAWK;IAC1B,IAAoCJ,2BAAAA,SAASiB,mBAAmBK,GAAG,OAA5DC,aAA6BvB,cAAjBwB,gBAAiBxB;IAEpC,IAAMyB,UAAUxB,OAAO;QAAC;QAAWmB,SAASM,GAAG;QAAEN,SAASO,IAAI;QAAEN;KAAO;mBAAE,kBAAA,gBAAkC;wBAA1BO,KAAKC,IAAIC,KAAKT,QAC1D,MAA5BU,WAAWC,eAWZC,oBAYKF,0BACCA,2BAPNG;;;;2DAlByEN,iBAAKC,gBAAIC,iBAAKT;wBAC1D;;4BAAMc,QAAQC,GAAG;gCAClDf,OAAOgB,MAAM,CAACjB;gCACdC,OAAOiB,oBAAoB,CAAClB;;;;wBAFK;4BAAA;;4BAA5BW,YAA4B,SAAjBC,gBAAiB;wBAKnC,IAAI,CAACX,OAAOkB,KAAK,IAAI,CAAClB,OAAOmB,OAAO,EAAE;4BACpC,MAAM,IAAInC,0BACR,sFACD;wBACH,CAAC;6BAEoBgB,OAAOkB,KAAK,EAAZlB;;;;wBACjB;;4BAAMb,kBAAkBwB,eAAe;gCACvCS,iBAAiBpB,OAAOoB,eAAe;4BACzC;;;+BAFE;;;;;;wBAGA;;4BAAMpB,OAAOmB,OAAO,CAAEpB;;;+BAAtB;;;wBAJEa;wBAMAC,gBAAgB3B,2BAA2BL,UAAU+B,aAAaS,OAAO,EAAE;4BAC/EC,KAAKX,cAAcY,QAAQ;4BAC3BC,WAAWb,cAAcY,QAAQ;4BACjCE,OAAOb,aAAaa,KAAK;4BACzBC,aAAad,aAAac,WAAW;4BACrCC,aAAaf,aAAagB,MAAM;4BAChCC,SAASnB,CAAAA,2BAAAA,UAAUoB,aAAa,cAAvBpB,sCAAAA,2BAA2B,EAAE;4BACtCqB,UAAUrB,CAAAA,4BAAAA,UAAUsB,cAAc,cAAxBtB,uCAAAA,8BAA8B;wBAC1C;wBAEA;;4BAAO;gCACLG,eAAAA;gCACAF,eAAAA;gCACAsB,KAAKvB;gCACLwB,UAAUtB;4BACZ;;;;QACF;;;;SAAG;QACDuB,mBAAmB,KAAK;IAC1B;IAEA,IAAMC,kBAAkB3D,YAAY,WAAM;QACxC0B,cAAcP,mBAAmBK,GAAG;IACtC,GAAG,EAAE;IAEL,IAAMoC,0BAA0B5D,YAAY,WAAM;QAChD0B,cAAcP,mBAAmB0C,WAAW;IAC9C,GAAG,EAAE;QAmBkBlC,6BACUA;IAlBjC,qBACE,oBAAChB;QAAImD,SAAS;OACXnC,QAAQoC,YAAY,kBACnB,oBAAC9C,8BAGFU,QAAQqC,KAAK,kBACZ,oBAAC9C,yBACEV,oBAAoBmB,QAAQqC,KAAK,IAIrCrC,QAAQsC,IAAI,kBACX,oBAACpD;QAAMqD,OAAO;OACT3C,OAAO4C,MAAM,CAACxC,QAAQsC,IAAI,CAACT,GAAG,EAAE7B,QAAQsC,IAAI,CAACR,QAAQ,gBACpD,oBAAC7C;QAAKwD,QAAQ;QAAGN,SAAS;YAAC;YAAG;YAAG;SAAE;qBACjC,oBAACzD;QACC2C,OAAOrB,CAAAA,8BAAAA,QAAQsC,IAAI,CAACT,GAAG,CAACa,SAAS,cAA1B1C,yCAAAA,8BAA8B,EAAE;QACvC2C,iBAAiB3C,CAAAA,qCAAAA,QAAQsC,IAAI,CAACT,GAAG,CAACe,gBAAgB,cAAjC5C,gDAAAA,qCAAqC,EAAE;QACxDkB,KAAKlB,QAAQsC,IAAI,CAAC/B,aAAa,CAACY,QAAQ;wBAIhD,oBAAC/B;QAAQmD,OAAO;qBACd,oBAACpD;QACCiB,IAAG;QACHyC,OAAM;QACNC,iBAAc;QACdC,UAAUjD,eAAeN,mBAAmBK,GAAG;QAC/CmD,SAAShB;sBAEX,oBAAC7C;QACCiB,IAAG;QACHyC,OAAM;QACNC,iBAAc;QACdC,UAAUjD,eAAeN,mBAAmB0C,WAAW;QACvDc,SAASf;uBAIb,oBAAC5C;QAASe,IAAG;QAAe6C,mBAAgB;QAAkBC,QAAQpD,eAAeN,mBAAmBK,GAAG;qBACzG,oBAACZ;QAAKkE,MAAK;QAAUV,QAAQ;QAAGN,SAAS;YAAC;YAAG;YAAG;SAAE;qBAChD,oBAACjD;QAAMqD,OAAO;OACXvC,QAAQsC,IAAI,CAAC7B,aAAa,CAACoB,GAAG,CAACuB,GAAG,CAAC,SAACC;6BACnC,oBAAC5D;YAAeU,KAAKkD,OAAOC,IAAI;YAAED,QAAQA;;yBAMlD,oBAAChE;QAASe,IAAG;QAAuB6C,mBAAgB;QAA0BC,QAAQpD,eAAeN,mBAAmB0C,WAAW;qBACjI,oBAACjD;QAAKkE,MAAK;QAAUV,QAAQ;QAAGN,SAAS;YAAC;YAAG;YAAG;SAAE;qBAChD,oBAACjD;QAAMqD,OAAO;OACXvC,QAAQsC,IAAI,CAAC7B,aAAa,CAAC8C,WAAW,CAACH,GAAG,CAAC,SAACC;6BAC3C,oBAAC5D;YAAeU,KAAKkD,OAAOC,IAAI;YAAED,QAAQA;;;AAS5D,EAAC"}