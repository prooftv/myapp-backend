{"version":3,"sources":["../../../src/utils/getYoastInsightsForContent.ts"],"sourcesContent":["import Jed from 'jed'\nimport get from 'just-safe-get'\nimport pixelWidth from 'string-pixel-width';\nimport { AssessmentRating, AssessmentResult } from 'yoastseo';\nimport yoastseoDefaultConfig from 'yoastseo/src/config/content/default.js'\nimport { AssessmentCategory } from '../constants';\n\ntype Options = {\n  keyword: string;\n  url: string;\n  permalink: string;\n  title: string;\n  synonyms: string[];\n  description: string;\n  langCulture: string;\n};\n\nconst IgnoredAssessments = [\n  'UrlLengthAssessment',\n  'TaxonomyTextLengthAssessment'\n]\n\nconst AssessmentClassConfigKeyMap = {\n  FleschReadingEaseAssessment: 'fleschReading',\n  SentenceLengthInTextAssessment: 'sentenceLength',\n}\n\nexport const getYoastInsightsForContent = (\n  YoastSEO: typeof import(\"yoastseo\"),\n  html: string,\n  options: Options\n) => {\n  const paper = new YoastSEO.Paper(html, {\n    keyword: options.keyword,\n    url: options.url,\n    permalink: options.permalink,\n    title: options.title,\n    ...(options.title && {\n      titleWidth: pixelWidth(options.title, { font: \"arial\", size: 20 }),\n    }),\n    synonyms: options.synonyms.join(\",\"),\n    description: options.description,\n    locale: options.langCulture.replace(\"-\", \"_\"),\n  })\n  const researcher = new YoastSEO.Researcher(paper)\n  const i18n = new Jed({\n    domain: 'js-text-analysis',\n    locale_data: { 'js-text-analysis': { '': {} } },\n  })\n\n  console.debug('YoastSEO.assessments', YoastSEO.assessments)\n  return Object.entries(YoastSEO.assessments).reduce<Record<AssessmentCategory, (AssessmentResult & {\n    rating: AssessmentRating\n  })[]>>((acc, [category, assessments]) => {\n    Object.entries(assessments).forEach(([name, value]) => {\n      if (!IgnoredAssessments.includes(name)) {\n        if (\n          typeof value === 'object'\n          && value?.hasOwnProperty('getResult')\n        ) {\n          const result = value.getResult(paper, researcher, i18n)\n          if (result?.text) {\n            acc[category as AssessmentCategory].push({\n              ...result,\n              rating: YoastSEO.helpers.scoreToRating(result.score),\n            })\n          }\n        } else if (typeof value === 'function') {\n          const configKey = get(AssessmentClassConfigKeyMap, name, null) as string | null | undefined\n          const config = configKey ? get(yoastseoDefaultConfig, configKey, {}) : {}\n          const result = new value(config).getResult(paper, researcher, i18n)\n          if (result?.text) {\n            acc[category as AssessmentCategory].push({\n              ...result,\n              rating: YoastSEO.helpers.scoreToRating(result.score),\n            })\n          }\n        }\n      }\n    });\n    if (Object.prototype.hasOwnProperty.call(acc, category)) {\n      acc[category as AssessmentCategory].sort((a, b) => {\n        if (a.rating === 'feedback') return -1\n        if (b.rating === 'feedback') return 1\n        return a.score < b.score ? -1 : 1\n      })\n    }\n    return acc\n  }, {\n    [AssessmentCategory.SEO]: [],\n    [AssessmentCategory.READABILITY]: [],\n  });\n};\n"],"names":["Jed","get","pixelWidth","yoastseoDefaultConfig","AssessmentCategory","IgnoredAssessments","AssessmentClassConfigKeyMap","FleschReadingEaseAssessment","SentenceLengthInTextAssessment","getYoastInsightsForContent","YoastSEO","html","options","paper","Paper","keyword","url","permalink","title","titleWidth","font","size","synonyms","join","description","locale","langCulture","replace","researcher","Researcher","i18n","domain","locale_data","console","debug","assessments","Object","entries","reduce","acc","category","forEach","name","value","includes","hasOwnProperty","result","getResult","text","push","rating","helpers","scoreToRating","score","configKey","config","prototype","call","sort","a","b","SEO","READABILITY"],"mappings":"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"}