{"version":3,"sources":["../../../src/components/SeoToolsPaneView.tsx"],"sourcesContent":["import React, { useCallback, useContext, useState } from 'react'\nimport useSWR from 'swr'\nimport YoastSEO from 'yoastseo'\nimport SerpPreview from 'react-serp-preview'\nimport { SeoToolsContext } from '../context'\nimport { InvalidConfigurationError } from '../errors'\nimport { extractErrorMessage, getYoastInsightsForContent, prepareRemoteData } from '../utils'\nimport { Box, Card, Grid, Spinner, Stack, Tab, TabList, TabPanel, Text } from '@sanity/ui'\nimport type { SanityDocument } from '@sanity/types'\nimport { SeoToolsAnalyzingCard } from './SeoToolsAnalyzingCard'\nimport { SeoToolsErrorCard } from './SeoToolsErrorCard'\nimport { AssessmentCategory } from '../constants'\nimport { SeoResultEntry } from './SeoResultEntry'\n\ntype Props = {\n  document: SanityDocument\n}\n\nexport const SeoToolsPaneView: React.FC<Props> = ({ document }) => {\n  const config = useContext(SeoToolsContext)\n  const [currentTab, setCurrentTab] = useState(AssessmentCategory.SEO)\n\n  const seoData = useSWR(['seoData', document._id, document._rev, config], async ([key, id, rev, config]) => {\n    const [seoFields, productionUrl] = await Promise.all([\n      config.select(document),\n      config.resolveProductionUrl(document),\n    ]);\n\n    if (!config.fetch && !config.prepare) {\n      throw new InvalidConfigurationError(\n        'When disabling the \"fetch\" behavior, you need to provide the prepare configuration'\n      )\n    }\n\n    const preparedData = config.fetch\n      ? await prepareRemoteData(productionUrl, {\n        contentSelector: config.contentSelector,\n      })\n      : await config.prepare!(document)\n\n    const yoastInsights = getYoastInsightsForContent(YoastSEO, preparedData.content, {\n      url: productionUrl.toString(),\n      permalink: productionUrl.toString(),\n      title: preparedData.title,\n      description: preparedData.description,\n      langCulture: preparedData.locale,\n      keyword: seoFields.focus_keyword ?? '',\n      synonyms: seoFields.focus_synonyms ?? [],\n    })\n\n    return {\n      yoastInsights,\n      productionUrl,\n      seo: seoFields,\n      prepared: preparedData,\n    }\n  }, {\n    revalidateOnFocus: false,\n  });\n\n  const handleSetSeoTab = useCallback(() => {\n    setCurrentTab(AssessmentCategory.SEO)\n  }, []);\n\n  const handleSetReadabilityTab = useCallback(() => {\n    setCurrentTab(AssessmentCategory.READABILITY)\n  }, []);\n\n  return (\n    <Box padding={3}>\n      {seoData.isValidating && (\n        <SeoToolsAnalyzingCard />\n      )}\n\n      {seoData.error && (\n        <SeoToolsErrorCard>\n          {extractErrorMessage(seoData.error)}\n        </SeoToolsErrorCard>\n      )}\n\n      {seoData.data && (\n        <Stack space={3}>\n            {config.render(seoData.data.seo, seoData.data.prepared, (\n              <Card shadow={1} padding={[2, 2, 3]}>\n                <SerpPreview\n                  title={seoData.data.seo.seo_title ?? ''}\n                  metaDescription={seoData.data.seo.meta_description ?? ''}\n                  url={seoData.data.productionUrl.toString()}\n                />\n            </Card>\n          ))}\n          <TabList space={2}>\n            <Tab\n              id=\"tablist-tab-seo\"\n              label=\"SEO\"\n              aria-controls=\"tabpanel-seo\"\n              selected={currentTab === AssessmentCategory.SEO}\n              onClick={handleSetSeoTab}\n            />\n            <Tab\n              id=\"tablist-tab-readability\"\n              label=\"Readability\"\n              aria-controls=\"tabpanel-readability\"\n              selected={currentTab === AssessmentCategory.READABILITY}\n              onClick={handleSetReadabilityTab}\n            />\n          </TabList>\n\n          <TabPanel id=\"tabpanel-seo\" aria-labelledby=\"tablist-tab-seo\" hidden={currentTab !== AssessmentCategory.SEO}>\n            <Card tone=\"default\" shadow={1} padding={[2, 2, 3]}>\n              <Stack space={3}>\n                {seoData.data.yoastInsights.seo.map((result) => (\n                  <SeoResultEntry key={result.text} result={result} />\n                ))}\n              </Stack>\n            </Card>\n          </TabPanel>\n\n          <TabPanel id=\"tabpanel-readability\" aria-labelledby=\"tablist-tab-readability\" hidden={currentTab !== AssessmentCategory.READABILITY}>\n            <Card tone=\"default\" shadow={1} padding={[2, 2, 3]}>\n              <Stack space={3}>\n                {seoData.data.yoastInsights.readability.map((result) => (\n                  <SeoResultEntry key={result.text} result={result} />\n                ))}\n              </Stack>\n            </Card>\n          </TabPanel>\n        </Stack>\n      )}\n    </Box>\n  )\n}"],"names":["SeoToolsPaneView","document","config","useContext","SeoToolsContext","useState","AssessmentCategory","SEO","currentTab","setCurrentTab","seoData","useSWR","_id","_rev","key","id","rev","seoFields","productionUrl","preparedData","yoastInsights","Promise","all","select","resolveProductionUrl","fetch","prepare","InvalidConfigurationError","prepareRemoteData","contentSelector","getYoastInsightsForContent","YoastSEO","content","url","toString","permalink","title","description","langCulture","locale","keyword","focus_keyword","synonyms","focus_synonyms","seo","prepared","revalidateOnFocus","handleSetSeoTab","useCallback","handleSetReadabilityTab","READABILITY","Box","padding","isValidating","SeoToolsAnalyzingCard","error","SeoToolsErrorCard","extractErrorMessage","data","Stack","space","render","Card","shadow","SerpPreview","seo_title","metaDescription","meta_description","TabList","Tab","label","aria-controls","selected","onClick","TabPanel","aria-labelledby","hidden","tone","map","result","SeoResultEntry","text","readability"],"mappings":"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"}